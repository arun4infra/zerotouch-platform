name: Validate Documentation

on:
  pull_request:
    paths:
      - 'artifacts/**'
  workflow_dispatch:

jobs:
  validate-docs:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyyaml

      - name: Make scripts executable
        run: |
          chmod +x artifacts/scripts/validate_doc_schemas.py
          chmod +x artifacts/scripts/detect_prose.py
          chmod +x artifacts/scripts/validate_filenames.py

      - name: Validate YAML Frontmatter Schemas
        run: |
          echo "::group::Schema Validation"
          python artifacts/scripts/validate_doc_schemas.py artifacts/
          echo "::endgroup::"

      - name: Check No-Fluff Policy (Tables/Lists Only)
        run: |
          echo "::group::Prose Detection"
          python artifacts/scripts/detect_prose.py artifacts/
          echo "::endgroup::"

      - name: Validate Filename Conventions
        run: |
          echo "::group::Filename Validation"
          python artifacts/scripts/validate_filenames.py artifacts/
          echo "::endgroup::"
      
      - name: Summary
        if: success()
        run: |
          echo "✅ All artifacts/ validation checks passed!"
          echo ""
          echo "✅ Frontmatter schemas valid"
          echo "✅ No prose paragraphs found (No-Fluff policy enforced)"
          echo "✅ All filenames follow naming conventions"
          echo ""
          echo "Note: docs/ directory is not validated (human zone, free-form allowed)"
